<!DOCTYPE html>
<html>

<!---
Might need to be removed in the final product

--->
<style>
table, td {
    border: 1px solid black;
}
</style>

<head>

</head>
<body>
<p><big>Welcome to the Food Group Recommendation Website</big></p>



<form id="FoodGroupInfo" >
  <p>Select your gender:</p>
  <select name="genderList" id="genderList">
    <option value="Male">Male</option>
    <option value="Female">Female</option>
  </select>


  <p>Select your age catagory:</p>
  <select name="ageCatagoryList" id="ageCatagoryList">
    <option value="2 to 3">2 to 3</option>
    <option value="4 to 8">4 to 8</option>
    <option value="9 to 13">9 to 13</option>
    <option value="14 to 18">14 to 18</option>
    <option value="19 to 30">19 to 30</option>
    <option value="31 to 50">31 to 50</option>
    <option value="51 to 70">51 to 70</option>
    <option value="71+">71+</option>
  </select>
  <p> </p>
</form>

<button onclick="handleSubmit()">Submit</button>

<p id="foodRecomendations"></p>

<table id="foodRecomendationsTable">
  <tr>
  <td>    </td>
  <td>Food Name</td>
  <td>Number of Servings</td>
  <td>Serving Size</td>
</tr>
</table>

<p id="testSlot"></p>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js" ></script>
<script>





var fg_directional_JSONdata;
var foodGroupJSONdata;
var foodsJSONdata;
var servingsPerDayJSONdata;

let foodGroups = ["vf", "gr", "mi", "me"]
let foodGroupsFullNames = ["Vegetables and Fruit", "Grains",
                      "Milk and Alternatives", "Meat and Alternatives"]

const vfFoodsStartIndex = 0;
const vfFoodsFinishIndex = 74;
const grFoodsStartIndex = 75;
const grFoodsFinishIndex = 113;
const miFoodsStartIndex = 114;
const miFoodsFinishIndex = 128;
const meFoodsStartIndex = 129;
const meFoodsFinishIndex = 153;


  //load the foodGroup json data
  $.getJSON('MyFoodGuideJSON/foodgroups-en.json', function(data) {
    foodGroupJSONdata = data;
  })

  //load the foods json data
  $.getJSON('MyFoodGuideJSON/foods-en.json', function(data) {
    foodsJSONdata = data;
  })

  //load the servings json data
  $.getJSON('MyFoodGuideJSON/servings_per_day-en.json', function(data) {
    servingsPerDayJSONdata = data;
  })



function handleSubmit()
{
  var text = ""
  var gender = document.getElementById("genderList");
  var ageCatagory = document.getElementById("ageCatagoryList");
  text += "ageCatagory: " + ageCatagory.value + "<br>";
  text += "genderList: " + gender.value + "<br>";

  var foodGroupServings = []
  foodGroups.forEach( function(foodGroup)
  {
    foodGroupServings.push(retrieveServings(ageCatagory.value, foodGroup, gender.value));
  });

  var i = 0;

  foodGroupServings.forEach( function(serving)
  {
      text += foodGroups[i] + " : " + serving + "<br>";
      i++;
  })

  i = 0;
  foodGroups.forEach( function(foodGroup)
  {
    var foodJSON = retriveRandomFood(foodGroup);
    var foodGroupFullName = foodGroupsFullNames[i];

    var table = document.getElementById("foodRecomendationsTable");

    var foodInformationRow = table.insertRow(table.rows.length)

    var foodGroupFullNameCell = createTableTextNode(foodGroupFullName, foodInformationRow);
    var foodNameCell = createTableTextNode(foodJSON.food, foodInformationRow);
    var foodServingsCell = createTableTextNode(foodGroupServings[i], foodInformationRow);
    var foodGroupServingsSizeCell = createTableTextNode(foodJSON.srvg_sz, foodInformationRow);




    //text += foodGroupFullName + " : " + foodJSON.food + " with " +
    //foodGroupServings[i] + " servings" + "<br>";
    i++;
  })


  document.getElementById("foodRecomendations").innerHTML = text;


}

function createTableTextNode(text, row)
{
  var tableCell = row.insertCell(row.length);
  var textNode = document.createTextNode(text);
  tableCell.appendChild(textNode);
  return tableCell;
}

  //This function aims to retrive a random food type
  //It will a return a json food object
  function retriveRandomFood(foodType)
  {
      var randomIndex = 0;
      if (foodType === "vf")
      {
        randomIndex = (vfFoodsFinishIndex - vfFoodsStartIndex) * Math.random() + vfFoodsStartIndex;

      } else if (foodType === "gr")
      {
        randomIndex = (grFoodsFinishIndex - grFoodsStartIndex) * Math.random() + grFoodsStartIndex;
      } else if (foodType === "mi")
      {
        randomIndex = (miFoodsFinishIndex - miFoodsStartIndex) * Math.random() + miFoodsStartIndex;
      } else if (foodType === "me")
      {
        randomIndex = (meFoodsFinishIndex - meFoodsStartIndex) * Math.random() + meFoodsStartIndex;
      } else {
        randomIndex = 0;
      }

      return foodsJSONdata.foods[Math.floor(randomIndex)];
  }



  //This function will retrieve the Servings of a food type
  function retrieveServings(ageRange, foodType, gender)
  {
    var ageRangeIndex = retrieveAgeRangeIndex(ageRange);

    var genderOffset;
    if (gender === "Female") {
      genderOffset = 0;
    } else {
      genderOffset = 1;
    }
    //Since the data switches between Female then Male
    //It makes it so that all the Female
    //Food indices are even and the male are odd

    const blockSize = 16;  //Since there are 8 ageGroups and 2 genders
    var foodGroupOffset = retriveFoodGroupOffset(foodType)
    var servingsIndex = Number(foodGroupOffset) * blockSize +
                        ageRangeIndex * 2  + genderOffset;

    const servPerMiyKey = "servings to per to miy"

    var numServings = servingsPerDayJSONdata[servPerMiyKey][servingsIndex].servings
    return numServings

  }
  function retriveFoodGroupOffset(foodType)
  {
    var index = 0;
    for (var i = 0; i < foodGroups.length; i++) {
      if (foodGroups[i] === foodType)
      {
        return index
      }
      index++;
    }

    return -1;
  }

  function retrieveAgeRangeIndex(ageRange)
  {
    if (ageRange === '2 to 3')
    {
      return 0;
    } else if (ageRange === "4 to 8")
    {
      return 1;
    } else if (ageRange === "9 to 13") {
      return 2;
    } else if (ageRange === "14 to 18") {
      return 3;
    } else if (ageRange === "19 to 30") {
      return 4;
    } else if (ageRange === "31 to 50") {
      return 5;
    } else if (ageRange === "51 to 70") {
      return 6;
    } else if (ageRange === "71+") {
      return 7; //should be 71+
    } else
    {
      return -1;
    }
  }





</script>









</body>
</html>
